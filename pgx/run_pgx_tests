source locate_files || exit 1
source message_functions || exit 1

info "Run PGX tests"

if [[ $# -eq 0 ]]; then
  venv_dir=$(locate_pgx_venv_dir)
else
  venv_dir=$1 && shift
fi

# pgx_base_dir=$HOME/repos/scripts/pgx
pgx_base_dir=$(locate_pgx_dir)

export PYTHONPATH="${PYTHONPATH}:${pgx_base_dir}"

# START VIRTUAL ENV
source "${venv_dir}/bin/activate" || die "Could not activate PGX venv"

python -m unittest discover --verbose --start-directory "${pgx_base_dir}" || die "Some PGX tests failed"

info "PGX tests succeeded"

mypy_config="${pgx_base_dir}/mypy.ini"

info "Run PGX type check"

mypy "${pgx_base_dir}" --config-file "${mypy_config}" --namespace-packages --explicit-package-bases || die "PGX type check failed"

info "PGX type succeeded"
