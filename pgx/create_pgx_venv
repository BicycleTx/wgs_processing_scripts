#!/usr/bin/env bash

source locate_files || exit 1
source message_functions || exit 1

info "Starting creation of PGX venv"

if [[ $# -eq 0 ]]; then
  venv_dir=$(locate_pgx_venv_dir)
else
  venv_dir=$1 && shift
fi

pgx_requirements=$(locate_pgx_requirements)

if [[ -d "${venv_dir}" ]] || [[ -f "${venv_dir}" ]]; then
    info "Delete existing PGX venv"
    rm -r  "${venv_dir}"
fi

python3 -m venv "${venv_dir}" || die "Could not create PGX venv"
source "${venv_dir}/bin/activate" || die "Could not activate PGX venv"
pip install -r "${pgx_requirements}" || die "Could not install PGX pip packages"

info "Finished creating PGX venv"