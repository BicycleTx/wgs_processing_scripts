#!/usr/bin/env bash

source message_functions || exit 1

set=$1 && shift
sample_name=$1 && shift

[[ -n "${set}" ]] || die "No set provided. Exiting"
[[ -n "${sample_name}" ]] || die "No sample_name provided. Exiting"


bucket="diagnostic-pipeline-output-prod-1"
protect_url="gs://${bucket}/${set}/protect/"

info "Checking primary tumor doid for run:"
report_doid=$(get_doids_for_biopsy ${sample_name} | sed -e $'s/,/\\\n/g' | sort -n | tr '\n' ',' | sed 's/.$//')
protect_doid=$(cat ${protect_url}/run.log | grep -w "initial tumor doids" | awk -F '[' '{print $NF}' | head -c -3 | sed -e $'s/,/\\\n/g' | sort -n | tr '\n' ',' | sed 's/.$//')
if [[ ${protect_doid} == "" ]]; then
    warn "The doid of protect ${protect_doid} is not known"
elif [[ ${protect_doid} == ${report_doid} ]]; then
    info "The doid is equal of protect ${protect_doid} and report ${report_doid}"
else
    warn "The doid is not equal of protect ${protect_doid} and report ${report_doid}"
fi