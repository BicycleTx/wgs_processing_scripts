#!/usr/bin/env bash

set=$1 && shift
bucket=$1 && shift
sample_id=$1 && shift

gs_path=gs://${bucket}/${set}
ds_path=/data/gcp/bam_downloads/bams_${set}

echo "[INFO] Downloading bam for ${sample_id} from ${gs_path}"
gcloud auth activate-service-account --key-file=/data/common/dbs/gcp_credentials/hmf-download

bam_path=$(gsutil -u hmf-database ls -r ${gs_path} | grep -Po "[^\s]*(mapping|aligner)/${sample_id}(_dedup)?(.realigned)?.bam$")

mkdir -p ${ds_path}
gsutil -u hmf-database cp ${bam_path} ${ds_path}/