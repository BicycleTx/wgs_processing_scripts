#!/usr/bin/env bash

source message_functions || exit 1
source locate_files || exit 1

# NOTES:
#  1. Manually prepare the configs in the config_dir (update dates + pipeline images)
#     - All available images for batch framework can be found via "gcloud container images list-tags eu.gcr.io/hmf-build/batch"
#  2. Manually build the batch-operations repo (mvn clean package)
#  3. Connect to VPN
#  4. Run this script
#  4. Manually apply the yaml files via kubectl apply -f ${yaml}, first star then isofox
#  5. Get the pod via kubectl get pods and then track log via kubectl logs ${pod}
#  6. Manually clean up the workloads + configmaps + buckets after successful running

config_dir="${HOME}/hmf/actin_batch_jobs/experiments/"

if [[ ! -d ${config_dir} ]]; then
    error "Could not locate config dir: ${config_dir}"
fi

batch_jar="${HOME}/hmf/repos/batch-operations/target/batch-operations-local-SNAPSHOT.jar"

if [[ ! -f ${batch_jar} ]]; then
    error "Could not locate batch jar: ${batch_jar}"
fi

kubectl create configmap actin-rna-experiment-inputs --from-file=actin_rna.csv=${config_dir}/actin_rna_experiment_input.csv

kubectl create configmap actin-rna-experiment-operations --from-file=batch-operations.jar=${batch_jar}
