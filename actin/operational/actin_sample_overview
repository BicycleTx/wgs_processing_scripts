#!/usr/bin/env bash

source message_functions || exit 1

actin_submission="HMFregACTN"

info "Querying LIMS regarding ACTIN samples"
query_lims.pl -rna -type samples -filter "submission=${actin_submission}" -filter "lab_status=process" | grep -v "^##"
echo ""

info "Querying API regarding ACTIN samples"
all_actin_samples=$(hmf_api_get "samples?submission=HMFregACTN")
echo "barcode\tname\ttype\tstatus"
jq -r '.[] | select(.status != "Deleted") | [.barcode,.name,.type,.status] | join("\t")' <<< "$all_actin_samples" | sort -k3
echo ""

info "Querying API regarding ACTIN runs"
all_actin_runs=$(hmf_api_get "runs?submission=HMFregACTN")
echo "set_name\tini\tstatus\tbucket"
jq -r '.[] | select(.bucket//"NA"|match("research")) | [.set.name,.ini,.status,.bucket] | join("\t")' <<< "${all_actin_runs}"
