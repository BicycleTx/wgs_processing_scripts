#!/bin/bash

sullivan=$1
picard=$2

bamfile=$3

tmpfastqdir=/data/tmp/fastq

# KODU: The silent validation stringency suppresses errors for pairs without a mate, which is needed for sliced bam
# but should not be needed for full BAM!
${picard} SamToFastq I=${bamfile} ODIR=${tmpfastqdir} OPRG=true RGT=ID NON_PF=true RC=true VALIDATION_STRINGENCY=SILENT

fastqpath1=$4
if [ "$#" -eq 4 ]; then
    ${sullivan} -fastqpath1 ${fastqpath1} -recreated ${tmpfastqdir}
fi

if [ "$#" -eq 5 ]; then
     fastqpath2=$5
     ${sullivan} -fastqpath1 ${fastqpath1} -fastqpath2 ${fastqpath2} -recreated ${tmpfastqdir}
fi

rm ${tmpfastqdir}/*.fastq