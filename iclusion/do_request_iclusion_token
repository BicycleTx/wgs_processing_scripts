#!/usr/bin/env bash

api_credentials=$1 && shift

endpoint=$(echo ${api_credentials} | sed 's/: /=/g' | sed 's/ /\n/g' | grep endpoint= | cut -d"=" -f2 | sed 's/"//g')
client_id=$(echo ${api_credentials} | sed 's/: /=/g' | sed 's/ /\n/g' | grep client_id= | cut -d"=" -f2 | sed 's/"//g')
client_secret=$(echo ${api_credentials} | sed 's/: /=/g' | sed 's/ /\n/g' | grep client_secret= | cut -d"=" -f2 | sed 's/"//g')
username=$(echo ${api_credentials} | sed 's/: /=/g' | sed 's/ /\n/g' | grep username= | cut -d"=" -f2 | sed 's/"//g')
password=$(echo ${api_credentials} | sed 's/: /=/g' | sed 's/ /\n/g' | grep password= | cut -d"=" -f2 | sed 's/"//g')

echo ${endpoint}/oauth/token"
curl --request POST \
  --url "${endpoint}/oauth/token" \
  --header 'Accept: application/json' \
  --header 'content-type: multipart/form-data;' \
  --form grant_type=password \
  --form client_id=${client_id} \
  --form client_secret=${client_secret} \
  --form username=${username} \
  --form password=${password}