#!/bin/bash

set=$1
rerun_bucket=$2
path=/data/schuberg/merged_runs
download_rerun -s ${set} -r ${rerun_bucket} -l ${path}
run_dir=${path}/${set}

structural_vcf=$(ls ${run_dir}/structuralVariants/bpi/*/*_somaticSV_bpi.vcf)
if [ $? -ne 0 ]
then
    do_run_bpi_prod ${run_dir}
fi

cobalt=$(ls ${run_dir}/cobalt/*.cobalt)
if [ $? -ne 0 ]
then
    do_run_cobalt ${run_dir}
    do_run_purple_prod ${run_dir}
    do_load_somatic_variants_prod ${run_dir}
fi

do_run_purple_pilot ${run_dir}

vcf_out=$(ls ${run_dir}/somaticVariants/*/*post_processed_strelka_filtered.vcf)
if [ $? -eq 0 ]
then
	rm ${vcf_out}
fi

do_apply_strelka_pon ${run_dir}
do_load_strelka_pon_pilot ${run_dir}

rm -f ${run_dir}/cobalt/*.count