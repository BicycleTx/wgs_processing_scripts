#!/bin/bash

echo "---"
RUN_NAME=$1 # eg 160101_HMFregCPCT_FR123_FR456_CPCT01010001
RUN_DIR=/data/processed_archive/${RUN_NAME}

SBP_FILE_COUNT=`sbp s3 ls s3://${ARCHIVE_BUCKET}/${RUN_NAME} --profile download --recursive --summarize --human-readable | tail -2 | grep "Total Objects" | grep -Po "[\d]+"`
SBP_FILE_SIZE=`sbp s3 ls s3://${ARCHIVE_BUCKET}/${RUN_NAME} --profile download --recursive --summarize --human-readable | tail -2 | grep "Total Size" | grep -Po "[\d\.]+ ?(GiB)?"`

HMF_FILE_COUNT=`find ${RUN_DIR} -type f | wc -l`
HMF_FILE_SIZE=`du -sh ${RUN_DIR} | awk '{ print $1 }' `

echo "# Run: ${RUN_NAME}"
echo "# Bucket: ${ARCHIVE_BUCKET}"
echo "# SBP: ${SBP_FILE_COUNT} files | ${SBP_FILE_SIZE}"
echo "# HMF: ${HMF_FILE_COUNT} files | ${HMF_FILE_SIZE}"