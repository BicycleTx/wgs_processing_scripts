#!/usr/bin/env bash

source api_functions

usage() {
    echo "---"
    echo "Usage: `basename $0` -s <set>" 1>&2;
    echo "       `basename $0` -s 170101_HMFregCPCT_etc" 1>&2;
    echo "---"
    exit 1
}

while getopts ":s:p:" o; do
    case "${o}" in
        s)
            set=${OPTARG} || usage
            ;;
        *)
            usage
            ;;
    esac
done

if [ -z "${set}" ]; then
    usage
fi

rerun_v3_info=$(load_rerun_v3_info_for_set ${set})
if [ -z "${rerun_v3_info}" ]; then
    echo "[ERROR] No v3 rerun found for set ${set}. Exiting."
    exit 1
fi

v3_rerun_bucket=`echo ${rerun_v3_info} | cut -d ' ' -f5`

sbp s3 sync s3://${v3_rerun_bucket}/${set}/ /data/schuberg/manta_results/${set}/ \
	--exclude "*" \
    --include "*structuralVariants*bpi*bpi_stats*" \
	--include "*structuralVariants*bpi*somaticSV*" \
	--include "*structuralVariants*bpi*sliced.bam*" \
	--include "*structuralVariants*manta*somaticSV.vcf*" \
	--profile download
