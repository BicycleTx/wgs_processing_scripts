#!/usr/bin/env bash

source message_functions || exit 1

sample=$1

if [[ -z ${sample} ]]; then
    error "No sample name provided"
fi

run_id=$( hmf_api_get "reports/created" | jq '.[] | select(.sample_name == "'${sample}'") | .run_id' | tail -1 )
set_name=$( hmf_api_get 'runs/'${run_id}'' | jq -r '.set | .name' )

### create temp folder in VM
temp_folder_path=$( pwd )"/temp_cp_${sample}"
mkdir $temp_folder_path

input "Do you want to copy the final OncoAct report? y or n"
read answer_report
if [[ ${answer_report} == "y" ]]; then
    gsutil cp gs://patient-reporter-final-prod-1/${sample}*.pdf ${temp_folder_path}/
fi

input "Do you want to copy the ORANGE report? y or n"
read answer_orange
if [[ ${answer_orange} == "y" ]]; then
    gsutil cp gs://diagnostic-pipeline-output-prod-1/${set_name}/orange/${sample}*.orange.pdf ${temp_folder_path}/
fi

gcloud compute scp --project="hmf-ops" --zone="europe-west4-a" --recurse "ops-vm-prod-1":${temp_folder_path}/ ./hmf_reports
rm -r ${temp_folder_path}/ 2>&1

