#!/usr/bin/env bash

genesCKB=/data/experiments/check_ensembl_versus_CKB_genes/input/210910_CKB_genes_dump_transcripts.tsv
genes_map_37_89=/data/experiments/check_ensembl_versus_CKB_genes/input/genes_map_37_89.tsv
genes_map_38_104=/data/experiments/check_ensembl_versus_CKB_genes/input/genes_map_38_104.tsv
genes_map_38_89=/data/experiments/check_ensembl_versus_CKB_genes/input/genes_map_38_89.tsv

echo "geneSymbol;transcript;ensembl_gene_transcript37_89;ensembl_exon_transcript37_89;ensembl_gene_transcript38_104;ensembl_exon_transcript38_104;ensembl_gene_transcript38_89;ensembl_exon_transcript38_89" > /data/experiments/check_ensembl_versus_CKB_genes/output/CKB_versus_ensembl_transcripts.csv

##checking genes of CKB present in ensembl
while IFS= read genes; do

    geneSymbol=$( echo ${genes} | awk '{print $1}')
    transcipt=$( echo ${genes} | awk '{print $2}')
    present_genes_map_37_89=$( cat ${genes_map_37_89} | awk '{print $2}' | grep -x ${geneSymbol} | wc -l)
    present_genes_map_38_104=$( cat ${genes_map_38_104} | awk '{print $2}' | grep -x ${geneSymbol} | wc -l)
    present_genes_map_38_89=$( cat ${genes_map_38_89} | awk '{print $2}' | grep -x ${geneSymbol} | wc -l)

    ensembl_gene_transcript37_89=""
    ensembl_gene_transcript38_104=""
    ensembl_gene_transcript38_89=""
    ensembl_exon_transcript37_89=""
    ensembl_exon_transcript38_104=""
    ensembl_exon_transcript38_89=""

    if [[ ${present_genes_map_37_89} -eq 1 ]]; then
      rowNumber=$(cat ${genes_map_37_89}| awk '{print $2}' | grep -xn ${geneSymbol} | awk 'BEGIN { FS=":"} {print $1}')
      ensembl_gene_transcript37_89=$(cat ${genes_map_37_89} | sed -n ${rowNumber}p | awk '{print $1}')
      ensembl_exon_transcript37_89=$(cat ${genes_map_37_89} | sed -n ${rowNumber}p| awk '{print $9}')
    else
      ensembl_gene_transcript37_89="NA"
      ensembl_exon_transcript37_89="NA"
    fi

    if [[ ${present_genes_map_38_104} -eq 1 ]]; then
      rowNumber=$(cat ${genes_map_38_104}| awk '{print $2}' | grep -xn ${geneSymbol} | awk 'BEGIN { FS=":"} {print $1}')
      ensembl_gene_transcript38_104=$(cat ${genes_map_38_104} | sed -n ${rowNumber}p | awk '{print $1}')
      ensembl_exon_transcript38_104=$(cat ${genes_map_38_104} | sed -n ${rowNumber}p | awk '{print $9}')
    else
      ensembl_gene_transcript38_104="NA"
      ensembl_exon_transcript38_104="NA"
    fi

    if [[ ${present_genes_map_38_89} -eq 1 ]]; then
      rowNumber=$(cat ${genes_map_38_89}| awk '{print $2}' | grep -xn ${geneSymbol} | awk 'BEGIN { FS=":"} {print $1}')
      ensembl_gene_transcript38_89=$(cat ${genes_map_38_89} | sed -n ${rowNumber}p | awk '{print $1}')
      ensembl_exon_transcript38_89=$(cat ${genes_map_38_89} | sed -n ${rowNumber}p | awk '{print $9}')
    else
      ensembl_gene_transcript38_89="NA"
      ensembl_exon_transcript38_89="NA"
    fi

    echo "${geneSymbol};${transcipt};${ensembl_gene_transcript37_89};${ensembl_exon_transcript37_89};${ensembl_gene_transcript38_104};${ensembl_exon_transcript38_104};${ensembl_gene_transcript38_89};${ensembl_exon_transcript38_89}" >> /data/experiments/check_ensembl_versus_CKB_genes/output/CKB_versus_ensembl_transcripts.csv

done < ${genesCKB}
