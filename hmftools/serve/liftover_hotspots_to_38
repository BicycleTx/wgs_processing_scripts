#!/usr/bin/env bash

working_dir=$1 && shift

if [[ ! -d "${working_dir}" ]]; then
    echo "[ERROR] No existing working dir passed. Exiting" && exit 1
fi

input_37_hotspots_gz=${working_dir}/KnownHotspots.SERVE.37.vcf.gz
target_37_hotspots=${working_dir}/KnownHotspots.somatic.hg19.vcf
target_38_hotspots=${working_dir}/KnownHotspots.somatic.hg38.vcf

### UPDATE CONTIGS WITH CHR
gunzip -c ${input_37_hotspots_gz} > ${target_37_hotspots}
sed -i 's/^/chr/g' ${target_37_hotspots}
sed -i 's/^chr#/#/g' ${target_37_hotspots}

#Liftover
java -jar /data/common/tools/picard-tools_v2.18.27/picard.jar LiftoverVcf \
    I=${target_37_hotspots} \
    O=${target_38_hotspots} \
    CHAIN=/data/common/refgenomes/liftover/hg19ToHg38.over.chain \
    REJECT=${working_dir}/rejected_variants.vcf \
    R=/data/common/refgenomes/Homo_sapiens.GRCh38/Homo_sapiens_assembly38.fasta

#Cleanup
rm ${target_37_hotspots}
rm ${target_38_hotspots}.idx
bgzip ${target_38_hotspots}
tabix ${target_38_hotspots}.gz

cp ${input_37_hotspots_gz} ${target_37_hotspots}.gz
tabix ${target_37_hotspots}.gz
