#!/usr/bin/env bash

source locate_files

output_dir=/data/common/dbs/serve/prod_output

if [[ -d "${output_dir}" ]]; then
    if [[ ! "$(ls -A ${output_dir})" ]]; then
        echo "[INFO] Output dir '${output_dir}' exists and will be cleaned!"
        rm -r ${output_dir}/*
    fi
else
    mkdir -p ${output_dir}
    echo "[INFO] Output dir created: ${output_dir}!"
fi

vicc_json=$(locate_vicc_json)
iclusion_trial_tsv=$(locate_prod_iclusion_trial_tsv)
docm_tsv=$(locate_docm_tsv)
hartwig_cohort_tsv=$(locate_hartwig_cohort_tsv)
hartwig_curated_tsv=$(locate_hartwig_curated_tsv)

do_run_serve_prod \
    -use_vicc -vicc_json ${vicc_json} -vicc_sources cgi,civic \
    -use_iclusion -iclusion_trial_tsv ${iclusion_trial_tsv} \
    -use_docm -docm_tsv ${docm_tsv} \
    -use_hartwig_cohort -hartwig_cohort_tsv ${hartwig_cohort_tsv} \
    -use_hartwig_curated -hartwig_curated_tsv ${hartwig_curated_tsv} \
    -output_dir ${output_dir} \
    "$@"
