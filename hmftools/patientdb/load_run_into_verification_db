#!/usr/bin/env bash

source locate_files || exit 1
source message_functions || exit 1
source secrets_functions || exit 1
source metadata_functions || exit 1

set -e

run_dir=$1 && shift

if [[ -z "${run_dir}" ]]; then
    error "No run dir passed. Exiting"
fi

patient_db_jar=$(locate_prod_patient_db)
secret_name="mysql-verification-db-writer"
credentials=$(get_secret_from_secret_manager "${secret_name}")
tumor_sample=$(load_tumor_sample_from_metadata "${run_dir}")
database="hmfpatients"

info "Config (tumor sample): $tumor_sample"
info "Config (patient db jar): $patient_db_jar"
info "Config (database): $database"
info "Config (secret name): ${secret_name}"

do_load_run_into_db "${run_dir}" "${patient_db_jar}" "${database}" "${credentials}"