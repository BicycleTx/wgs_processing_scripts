#!/bin/bash
source load_metadata

prefix=`dirname $(readlink $0 || echo $0)`
run_dir=$1 && shift

credentials=/data/common/dbs/mysql_credentials/pilot
patient_db_jar=/data/common/tools/purple_pilot/purple.jar

somatic_vcf=$(find -L ${run_dir}/somaticVariants/*/ -type f -name *post_processed.vcf.gz)
if [ -z ${somatic_vcf} ]; then
    echo "[ERROR] Unable to locate post processed somatic variants. Exiting."
    exit 1
fi

sample=$(load_tumor_sample_from_metadata ${run_dir})
${prefix}/do_load_somatic_variants ${sample} ${somatic_vcf} ${credentials} ${patient_db_jar} $@
