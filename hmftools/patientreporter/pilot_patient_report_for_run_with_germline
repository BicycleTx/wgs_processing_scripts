#!/bin/bash
source locate_files
source load_metadata

run_dir=$1 && shift

prefix=`dirname $(readlink $0 || echo $0)`

knowledgebase_path=/data/common/dbs/knowledgebases/output
drup_genes_csv=/data/common/dbs/drup/180905_drup_genes.csv
hotspot_tsv=$(locate_hotspot_tsv)

ref_genome=/data/common/refgenomes/Homo_sapiens.GRCh37.GATK.illumina/Homo_sapiens.GRCh37.GATK.illumina.fasta
high_confidence_bed=/data/common/dbs/GIAB_NIST_v3.2.2/NA12878_GIAB_highconf_IllFB-IllGATKHC-CG-Ion-Solid_ALLCHROM_v3.2.2_highconf.bed.gz

fusion_pairs_csv=/data/common/dbs/fusions/knownFusionPairs.csv
promiscuous_five_csv=/data/common/dbs/fusions/knownPromiscuousFive.csv
promiscuous_three_csv=/data/common/dbs/fusions/knownPromiscuousThree.csv

sample=$(load_tumor_sample_from_metadata ${run_dir})
fusion_csv=${run_dir}/svAnalysis/${sample}_fusions.csv
disruption_csv=${run_dir}/svAnalysis/${sample}_disruptions.csv

${prefix}/pilot_do_run_base_patient_reporter \
    -knowledgebase_path ${knowledgebase_path} \
    -drup_genes_csv ${drup_genes_csv} \
    -hotspot_tsv ${hotspot_tsv} \
    -fasta_file_location ${ref_genome} \
    -fusion_pairs_csv ${fusion_pairs_csv} \
    -promiscuous_five_csv ${promiscuous_five_csv} \
    -promiscuous_three_csv ${promiscuous_three_csv} \
    -high_confidence_bed ${high_confidence_bed} \
    -fusion_csv ${fusion_csv} \
    -disruption_csv ${disruption_csv} \
    -do_report_germline \
    -run_dir ${run_dir} \
    "$@"
