#!/bin/bash
source load_metadata

prefix=`dirname $(readlink $0 || echo $0)`
run_dir=$1 && shift

credentials=/data/common/dbs/mysql_credentials/prod
sv_jar=/data/common/tools/variantannotator_v2.4/variant-annotator.jar
sample=$(load_tumor_sample_from_metadata ${run_dir})

gridss_filtered_vcf=$(find -L ${run_dir}/structuralVariants/gridss/*/ -type f -name *.gridss.somatic.vcf.gz)
if [ -z ${gridss_filtered_vcf} ]; then
    echo "[ERROR] No GRIDSS filtered somatic vcf found. Exiting."
    exit 1
fi

structural_vcf=$(find -L ${run_dir}/purple/ -type f -name *.purple.sv.vcf.gz)
if [ -z ${structural_vcf} ]
then
    echo "[ERROR] Unable to locate gridss structural variants. Exiting."
    exit 1
fi

${prefix}/do_run_sv_loader ${sample} ${structural_vcf} ${credentials} ${sv_jar} $@
