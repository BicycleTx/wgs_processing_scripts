#!/bin/bash

db_pass=$1
sample=$2

db_user=hmf
db_url=mysql://localhost:3306/hmfpatients?serverTimezone=CET
circos_dir=/data/common/tools/circos-0.69-5/purple

echo "Generating circos data"
java -cp /data/common/tools/purple-v1.0/purity-ploidy-estimator-1.0.jar com.hartwig.hmftools.purple.GenerateCircosData -output_dir ${circos_dir}/data -db_user ${db_user} -db_pass ${db_pass} -db_url ${db_url} -sample ${sample}

#echo "Resampling data"
#tail -n+2 ${circos_dir}/data/${sample}.snp.circos | /data/common/tools/circos-tools-0.22/tools/resample/bin/resample -bin 1e5 -avg > ${circos_dir}/data/${sample}.resampled.snp.circos

echo "Substituting SAMPLE name for" ${sample}
sed "s/SAMPLE/${sample}/g" ${circos_dir}/etc/circos.template > ${circos_dir}/etc/${sample}.circos.conf

echo "Generating plot"
${circos_dir}/../bin/circos -conf ${circos_dir}/etc/${sample}.circos.conf -outputdir ${circos_dir}/plot/ -outputfile ${sample}.circos.png -debug_group summary,timer > ${circos_dir}/run.out