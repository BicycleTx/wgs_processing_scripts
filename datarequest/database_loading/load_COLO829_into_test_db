#!/usr/bin/env bash

# Configuration of paths
db_loader_jar=${HOME}/hmf/demo_database/hmf-db-loader.jar
data_dir=${HOME}/hmf/DR-COLO829-Example/somatics/190830_COLO829v003_v5.3

# Configuration of external inputs required to load up the data
ref_genome=${HOME}/hmf/refgenome/Homo_sapiens.GRCh37.GATK.illumina.fasta
high_confidence_bed=${HOME}/hmf/resources/NA12878_GIAB_highconf_IllFB-IllGATKHC-CG-Ion-Solid_ALLCHROM_v3.2.2_highconf.bed.gz
hotspot_tsv=${HOME}/hmf/resources/KnownHotspots.tsv

# Database configuration
db_url="mysql://localhost:3306/testdb?serverTimezone=CET"
db_user="test"
db_pass="test"

# Resolving of actual file locations based on data dir
structural_vcf=$(find ${data_dir} -name "*.purple.sv.ann.vcf.gz")
somatic_vcf=$(find ${data_dir} -name "*.purple.somatic.vcf.gz")
tumor_sample=$(basename ${structural_vcf} | cut -d"." -f1)

# load purple data
java -cp ${db_loader_jar} com.hartwig.hmftools.patientdb.LoadPurpleData \
    -sample ${tumor_sample} \
    -purple_dir ${data_dir} \
    -data_request \
    -db_user ${db_user} \
    -db_pass ${db_pass} \
    -db_url ${db_url}

# load somatic variants
java -cp ${db_loader_jar} com.hartwig.hmftools.patientdb.LoadSomaticVariants \
    -high_confidence_bed ${high_confidence_bed} \
    -vcf_file ${somatic_vcf} \
    -sample ${tumor_sample} \
    -hotspot ${hotspot_tsv} \
    -db_user ${db_user} \
    -db_pass ${db_pass} \
    -db_url ${db_url}

# load structural variants
java -cp ${db_loader_jar} com.hartwig.hmftools.patientdb.LoadStructuralVariants \
    -structural_vcf ${structural_vcf} \
    -tumor ${tumor_sample}  \
    -ref_genome ${ref_genome} \
    -db_user ${db_user} \
    -db_pass ${db_pass} \
    -db_url ${db_url}
