#!/usr/bin/env bash

base_path="/data/data_archive/validation_data/latest_tooling_pipeline_runs"
colo_folder=$( ls ${base_path} | grep "COLO" )
source_set_path="${base_path}/${colo_folder}"
#
dest_base_path="/data/data_archive/datarequests/colo"
#
colo_exists=$( ls $dest_base_path | grep ${colo_folder})
if [[ "$colo_exists" == "" ]]; then
    echo "[DEBUG] latest version not yet on GCP. Latest version will be added."
    mkdir ${dest_base_path}/${colo_folder}
    dest_set_base_path="${dest_base_path}/${colo_folder}"
    #
    somatic_tar_file="${dest_base_path}/${colo_folder}.somatics.tar"
    germline_tar_file="${dest_base_path}/${colo_folder}.germline.tar"
    #
    include_germline=1
    
    collect_somatic_set_data ${source_set_path} ${dest_set_base_path}/somatics ${include_germline}
    create_tar_file ${somatic_tar_file} ${dest_base_path} ${dest_set_base_path}/somatics ${dest_set_base_path}/tar_${colo_folder}_somatics.log
    
    collect_germline_set_data ${source_set_path} ${dest_set_base_path}/germline
    create_tar_file ${germline_tar_file} ${dest_base_path} ${dest_set_base_path}/germline  ${dest_set_base_path}/tar_${colo_folder}_germline.log
    
    gsutil -u hmf-share cp ${dest_base_path}/*.tar gs://hmf-dr-colo/
    echo "[INFO] latest version added to GCP."
else
    echo "[INFO] latest version already on GCP."
fi

echo ""
echo "[INFO] Files in the bucket /hmf-dr-colo/:"
gsutil du -h gs://hmf-dr-colo/
echo ""

