#!/usr/bin/env bash

setPath=$1
setName=$( basename ${setPath} )
destDir=./data/${setName}

if [[ ! -d ${setPath} ]]; then echo "[EXIT] From dir not found ($setPath)" && exit 1; fi
if [[ ! -w $PWD ]]; then echo "[EXIT] Dir not writable ($PWD)" && exit 1; fi

## init
mkdir -p ${destDir}

## gather info
metaDataJsonV5="${setPath}/metadata.json"
metaDataJsonV4="${setPath}/metadata"
tumSample=""
if [[ -f ${metaDataJsonV5} ]]; then
  tumSample=$( cat ${metaDataJsonV5} | jq -r '.tumor.sampleName' )
elif [[ -f ${metaDataJsonV4} ]]; then
  tumSample=$( cat ${metaDataJsonV4} | jq -r '.tumor_sample' )
else
  echo "[EXIT] No metadata found (dir:$setPath)" && exit 1
fi

## start symlinking
echo "[INFO] Symlinking files for ${setName}"
ln -s ${setPath}/purple/purple.version ${destDir}
ln -s ${setPath}/purple/${tumSample}.purple.cnv.germline.tsv ${destDir}
ln -s ${setPath}/purple/${tumSample}.purple.cnv.somatic.tsv ${destDir}
ln -s ${setPath}/purple/${tumSample}.purple.cnv.gene.tsv ${destDir}
ln -s ${setPath}/purple/${tumSample}.purple.purity.tsv ${destDir}
ln -s ${setPath}/purple/${tumSample}.purple.purity.range.tsv ${destDir}
ln -s ${setPath}/purple/${tumSample}.purple.qc ${destDir}
ln -s ${setPath}/purple/${tumSample}.purple.sv.ann.vcf.gz ${destDir}
ln -s ${setPath}/purple/${tumSample}.purple.sv.ann.vcf.gz.tbi ${destDir}
ln -s ${setPath}/purple/plot/${tumSample}.circos.png ${destDir}
ln -s ${setPath}/purple/${tumSample}.purple.somatic.vcf.gz ${destDir}
ln -s ${setPath}/purple/${tumSample}.purple.somatic.vcf.gz.tbi ${destDir}