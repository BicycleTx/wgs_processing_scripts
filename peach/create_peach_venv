#!/usr/bin/env bash

source locate_files || exit 1
source message_functions || exit 1

info "Starting creation of PEACH venv"

# Parse args
while [[ $# -gt 0 ]]
do
key="$1" && shift
case $key in
    -r|--requirements)
    peach_requirements="$1" && shift  # Optional argument
    ;;
    -v|--venv)
    venv_dir="$1" && shift  # Optional argument
    ;;
    *)    # Unknown option
    OTHER_OPTIONS+=("$key") # Save it in an array for later
    ;;
esac
done

# Default values for arguments
if [[ -z ${venv_dir} ]]; then
  venv_dir=$(locate_peach_venv_dir)
fi
if [[ -z ${peach_requirements} ]]; then
  peach_requirements=$(locate_peach_requirements)
fi

# Sanity checks
[[ "${#OTHER_OPTIONS[@]}" -eq 0 ]] || die "Unrecognized options! : ${OTHER_OPTIONS[*]}"
[[ -f ${peach_requirements} ]] || die "PEACH requirements file should be a file: ${peach_requirements}."

# Create venv
create_python_venv --venv_dir "${venv_dir}" --requirements "${peach_requirements}"

info "Finished creating PEACH venv"